# Front Gate 2FA — réécriture conditionnelle
# - Si le fichier frontgate.lock existe à la racine: tout le site passe par frontgate.php
# - Sinon: seules les pages admin sont protégées (admin.html, admin-login.html)

Options -Indexes
RewriteEngine On

# Laisser passer le frontgate lui-même
RewriteRule ^frontgate\.php$ - [L]

# Mode verrou global activé par fichier
RewriteCond %{DOCUMENT_ROOT}/frontgate.lock -f
RewriteCond %{REQUEST_URI} !^/frontgate\.php$
RewriteRule ^(.*)$ /frontgate.php?fg_path=$1 [L,QSA]

# Sinon, protéger seulement l'admin
RewriteCond %{DOCUMENT_ROOT}/frontgate.lock !-f
RewriteCond %{REQUEST_URI} ^/(admin\.php|admin\.html|admin-login\.html|admin-enroll\.html)$ [NC]
RewriteRule ^(.*)$ /frontgate.php?fg_path=$1 [L,QSA]
